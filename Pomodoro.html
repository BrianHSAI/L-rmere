<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pomodoro Opgave App - Lærmere.nu</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* Generelle stilarter */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            /* Anvend Nunito skrifttypen */
            font-family: 'Nunito', sans-serif;
        }

        /* Farver fra Elevkalender/Tekstoplæser */
        :root {
            --primary-blue: #5DADE2; /* Lysere blå */
            --primary-green: #82E0AA; /* Lysere grøn */
            --primary-orange: #F5B041; /* Lysere orange */
            --dark-teal: #1ABC9C; /* Mindre dyster teal */
            --text-color: #2C3E50; /* Mørkere, men blød tekstfarve */
            --background-color: #EBF5FB; /* Meget lys og venlig baggrundsblå */
            --card-bg: #FFFFFF; /* Hvid baggrund for kort */
            --card-border: #D6EAF8; /* Lysere blå kant til kort */
            --header-bg: var(--primary-blue); /* Blå baggrund for header */
            --header-text: white; /* Hvid tekst i header */
            --button-primary-bg: var(--primary-green); /* Grøn knap baggrund */
            --button-primary-hover: #6BB38A; /* Mørkere grøn ved hover */
            --button-secondary-bg: white; /* Hvid knap baggrund */
            --button-secondary-border: var(--dark-teal); /* Mørk teal kant på knap */
            --button-secondary-hover: #ECF5EE; /* Meget lys grøn ved hover */
            --button-danger-text: #E74C3C; /* Rød farve for fare knap */
            --button-danger-hover: #FADBD8; /* Lys rød ved hover */
            --activity-bg-hover: #F2F4F6; /* Meget lys grå ved hover på aktivitet */
            --activity-border: #E5E7EB; /* Grå kant mellem aktiviteter */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius-sm: 0.25rem;
            --radius: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;

             /* Specifikke Pomodoro farver - tilpasset designet */
             --pomodoro-primary: var(--primary-orange); /* Orange til timer/mode */
             --pomodoro-progress: var(--primary-green); /* Grøn til fremdrift */
             --pomodoro-break: var(--dark-teal); /* Teal til pause */
             --pomodoro-success: var(--primary-green); /* Grøn til succes/færdig */
        }

        body {
            background-color: var(--background-color); /* Anvend baggrundsfarve */
            color: var(--text-color); /* Anvend tekstfarve */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            /* Fjern justify-content: center for at tillade indhold at starte øverst */
            /* justify-content: center; */
            padding: 1.5rem; /* Juster padding */
            line-height: 1.6; /* Juster line height */
        }

        /* NY STIL: Styling for tilbage-knap container */
        .back-button-container {
            width: 100%;
            max-width: 500px; /* Match container bredde */
            margin: 0 auto 1rem auto; /* Centrer og giv bundmargin */
            text-align: left; /* Juster knap til venstre */
        }

        .container {
            width: 100%;
            max-width: 500px;
            margin: 0 auto; /* Behold centreret margin */
        }

        .app-title {
            font-size: 2.5rem; /* Større skriftstørrelse */
            font-weight: 700; /* Federe skrift */
            text-align: center;
            margin-bottom: 1.5rem; /* Juster margin for at give plads til border */
             color: var(--dark-teal); /* Anvend dark teal farve */
             padding-bottom: 0.5rem; /* Mellemrum under tekst før border */
             border-bottom: 3px solid var(--primary-orange); /* Orange understregning */
        }

        .mode-indicator {
            text-align: center;
            font-weight: 700; /* Federe skrift */
            margin-bottom: 0.8rem; /* Juster margin */
            color: var(--pomodoro-primary); /* Anvend pomodoro primary farve */
            font-size: 1.1rem; /* Lidt større skrift */
        }

        .timer-display {
            font-size: 4rem; /* Større skrift */
            font-weight: 700; /* Federe skrift */
            text-align: center;
            margin: 1rem 0; /* Juster margin */
            color: var(--pomodoro-primary); /* Anvend pomodoro primary farve */
             letter-spacing: -0.05em; /* Mindre mellemrum mellem tegn */
        }

        /* Kort styling (genbrugt) */
        .card {
            background-color: var(--card-bg);
            border-radius: var(--radius-lg); /* Større afrunding */
            box-shadow: var(--shadow-md); /* Kraftigere skygge */
            padding: 1.5rem; /* Juster padding */
            margin-bottom: 1.5rem; /* Juster margin */
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease;
             border: 1px solid var(--card-border); /* Anvend kantfarve */
        }

        .card.task-card {
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .card.break-card {
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .card.break-card:hover {
            transform: translateY(-5px);
        }

        .progress-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 6px; /* Lidt tykkere */
            background-color: var(--pomodoro-progress); /* Anvend pomodoro progress farve */
            width: 0%;
            transition: width 1s linear;
        }

         .break-progress-bar { /* Tilføj specifik klasse til pause progress bar */
             position: absolute;
             bottom: 0;
             left: 0;
             height: 6px; /* Lidt tykkere */
             background-color: var(--pomodoro-break); /* Anvend pomodoro break farve */
             width: 0%;
             transition: width 1s linear;
         }


        .task-text {
            font-size: 1.5rem;
            text-align: center;
            margin: 1.5rem 0; /* Juster margin */
            font-weight: 700; /* Federe skrift */
            color: var(--text-color); /* Anvend tekstfarve */
        }

         .break-text { /* Styling for pausetekst */
             font-size: 1.5rem;
             text-align: center;
             margin: 1rem 0 0.5rem 0; /* Juster margin */
             font-weight: 700;
             color: var(--pomodoro-break); /* Anvend pomodoro break farve */
         }


        .long-break-message {
            font-size: 1.1rem; /* Lidt mindre end pausetekst */
            text-align: center;
            margin-bottom: 1rem; /* Juster margin */
            font-weight: 700;
            color: var(--dark-teal); /* Anvend dark teal farve */
        }


        .button-container {
            display: flex;
            justify-content: center;
            gap: 0.8rem; /* Juster mellemrum */
            margin-top: 1.5rem; /* Juster margin */
        }

        /* Knapper (genbrugt) */
        button, a.btn { /* Tilføj a.btn for at style link som knap */
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.6rem 1.2rem; /* Juster padding */
            border: none;
            border-radius: var(--radius); /* Afrundede hjørner */
            cursor: pointer;
            font-weight: 700; /* Federe skrift */
            transition: all 0.2s ease; /* Glattere overgang */
             gap: 0.5rem; /* Mellemrum mellem ikon og tekst */
             box-shadow: var(--shadow-sm);
             font-size: 1rem; /* Standard skriftstørrelse */
             text-decoration: none; /* Fjern understregning fra link-knap */
        }

        .btn-primary {
            background-color: var(--button-primary-bg); /* Anvend primary farve */
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--button-primary-hover); /* Anvend primary hover farve */
             box-shadow: var(--shadow);
        }

        .btn-secondary {
            background-color: var(--button-secondary-bg); /* Anvend secondary baggrund */
            color: var(--button-secondary-border); /* Anvend secondary border farve til tekst */
             border: 1px solid var(--button-secondary-border); /* Anvend secondary border farve til kant */
        }

        .btn-secondary:hover {
            background-color: var(--button-secondary-hover); /* Anvend secondary hover farve */
             box-shadow: var(--shadow);
             color: var(--button-secondary-border); /* Sørg for at tekstfarve forbliver ved hover */
        }


        .completion-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(235, 245, 251, 0.9); /* Baggrundsfarve med gennemsigtighed */
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .completion-animation.active {
            opacity: 1;
        }

        .check-mark {
            font-size: 8rem;
            color: var(--pomodoro-success); /* Anvend pomodoro success farve */
            transform: scale(0);
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .completion-animation.active .check-mark {
            transform: scale(1);
        }

        .swipe-area {
            touch-action: pan-x;
            position: relative;
            /* Tilføj styling for visuel indikator */
             border: 2px dashed transparent; /* Stiplet kant som standard */
             border-radius: var(--radius);
             transition: border-color 0.3s ease;
        }

         .swipe-area.swiping { /* Styling når der swipes */
             border-color: var(--primary-orange); /* Orange kant ved swipe */
         }


        .hidden {
            display: none;
        }

        .add-task-form {
            margin-top: 1.5rem; /* Juster margin */
        }

        .form-group {
            margin-bottom: 1.5rem; /* Juster margin */
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 700; /* Federe skrift */
             color: var(--text-color); /* Anvend tekstfarve */
        }

        input:not([type="checkbox"]), select { /* Inkluder select */
            width: 100%;
            padding: 0.75rem; /* Juster padding */
            border: 1px solid var(--activity-border); /* Anvend kantfarve */
            border-radius: var(--radius); /* Afrundede hjørner */
            font-size: 1rem;
            background-color: white; /* Hvid baggrund */
            color: var(--text-color); /* Anvend tekstfarve */
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

         input:not([type="checkbox"]):focus, select:focus { /* Inkluder select */
             border-color: var(--dark-teal); /* Mørk teal ved focus */
             box-shadow: 0 0 0 4px rgba(26, 188, 156, 0.2); /* Gennemsigtig teal skygge */
             outline: none;
         }


        .settings-icon {
            position: absolute;
            top: 1.5rem; /* Juster position */
            right: 1.5rem; /* Juster position */
            cursor: pointer;
            font-size: 1.8rem; /* Større ikon */
            color: var(--dark-teal); /* Anvend dark teal farve */
            transition: color 0.2s ease;
        }

         .settings-icon:hover {
             color: var(--primary-blue); /* Blå farve ved hover */
         }


        .settings-panel {
            position: fixed;
            top: 0;
            right: -300px;
            width: 300px;
            height: 100%;
            background-color: var(--card-bg); /* Anvend kort baggrund */
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
            padding: 1.5rem; /* Juster padding */
            transition: right 0.3s ease;
            z-index: 1000;
             border-left: 1px solid var(--card-border); /* Kant til venstre */
        }

        .settings-panel.open {
            right: 0;
        }

        .close-settings {
            position: absolute;
            top: 1rem; /* Juster position */
            right: 1rem; /* Juster position */
            cursor: pointer;
            font-size: 1.5rem;
            color: var(--text-color); /* Anvend tekstfarve */
        }

        .settings-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem; /* Juster margin */
            padding-bottom: 1rem; /* Juster padding */
            border-bottom: 2px solid var(--primary-orange); /* Orange understregning */
             color: var(--dark-teal); /* Anvend dark teal farve */
        }

        .task-list {
            margin-top: 1.5rem; /* Juster margin */
            border: 1px solid var(--activity-border); /* Kant */
            border-radius: var(--radius); /* Afrundede hjørner */
            overflow: hidden; /* Sikrer afrunding */
        }

        .task-item {
            display: flex;
            justify-content: space-between;
            align-items: center; /* Centrer vertikalt */
            padding: 0.8rem 1rem; /* Juster padding */
            border-bottom: 1px solid var(--activity-border); /* Kant */
            background-color: var(--background-color); /* Lys baggrund */
             gap: 1rem; /* Mellemrum mellem tekst og knap */
        }

        .task-item:last-child {
            border-bottom: none;
        }

         .task-item span {
             flex-grow: 1; /* Tillad tekst at fylde plads */
             font-size: 1rem;
             color: var(--text-color);
         }


        .long-break-message {
            font-size: 1.2rem;
            text-align: center;
            margin: 1.5rem 0;
            font-weight: 700;
            color: var(--dark-teal); /* Anvend dark teal */
        }

         /* Print styles */
         @media print {
             body {
                 background-color: white;
                 color: black;
                 padding: 0;
             }
             .print-hide {
                 display: none !important;
             }
              /* NY print regel */
              .back-button-container {
                  display: none !important;
              }
             .container {
                 padding: 0;
             }
             .card {
                 box-shadow: none;
                 border: none;
                 border-radius: 0;
                 padding: 1rem;
                 margin-bottom: 1rem;
             }
             .app-title {
                 color: #000;
                 border-bottom-color: #ddd;
             }
             .mode-indicator {
                 color: #555;
             }
             .timer-display {
                 color: #000;
             }
             .task-text, .break-text {
                 color: #000;
             }
             .long-break-message {
                 color: #000;
             }
              .progress-bar, .break-progress-bar {
                  display: none; /* Skjul progress bars ved print */
              }
              .task-list {
                  border: none;
              }
              .task-item {
                  border-bottom: 1px dashed #ddd;
                  background-color: white;
                  padding: 0.5rem 0;
              }
               .task-item span {
                   color: #000;
               }
         }
    </style>
</head>
<body>
    <!-- START: Tilbage-knap -->
    <div class="back-button-container print-hide">
        <a href="index.html" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Tilbage
        </a>
    </div>
    <!-- SLUT: Tilbage-knap -->

    <div class="container">
        <h1 class="app-title">Pomodoro Opgave App</h1>

        <div class="mode-indicator" id="modeIndicator">Fokustid</div>

        <div class="timer-display" id="timerDisplay">25:00</div>

        <div class="card" id="initialTaskInput">
            <h2>Tilføj dine opgaver</h2>
            <div class="form-group">
                <label for="newTaskInput">Opgave:</label>
                <input type="text" id="newTaskInput" placeholder="F.eks. Læs kapitel 5">
            </div>
            <div class="button-container">
                <button class="btn-primary" id="addNewTaskBtn">
                     <i class="fas fa-plus"></i> Tilføj opgave
                </button>
                <button class="btn-primary" id="startTasksBtn" disabled> <!-- Start deaktiveret -->
                     <i class="fas fa-play"></i> Start Pomodoro
                </button>
            </div>

            <div class="task-list" id="taskList">
                <!-- Opgaveliste indsættes her af JS -->
                 <div class="text-center text-muted mt-4">Ingen opgaver tilføjet endnu.</div>
            </div>
        </div>

        <div class="card task-card hidden" id="taskCard">
            <div class="progress-bar" id="progressBar"></div>
            <div class="swipe-area" id="swipeArea">
                <div class="task-text" id="taskText"></div>
            </div>
            <div class="button-container">
                <button class="btn-primary" id="startPauseBtn"> <!-- Start som primær knap -->
                     <i class="fas fa-play"></i> Start
                </button>
                <button class="btn-primary" id="completeBtn">
                    <i class="fas fa-check"></i> Færdig
                </button>
            </div>
        </div>

        <div class="card break-card hidden" id="breakCard">
            <div class="break-progress-bar" id="breakProgressBar"></div>
            <div class="break-text" id="breakText">Pause</div>
            <div class="long-break-message hidden" id="longBreakMessage"></div>
            <div class="timer-display" id="breakTimerDisplay">05:00</div>
            <!-- Knapper til pause er ikke nødvendige her, da den starter/stopper automatisk -->
        </div>

        <div class="completion-animation" id="completionAnimation">
            <div class="check-mark">✓</div>
        </div>

    </div> <!-- Slut .container -->

    <script>
        // DOM Elements
        const timerDisplay = document.getElementById('timerDisplay');
        const progressBar = document.getElementById('progressBar');
        const taskText = document.getElementById('taskText');
        const startPauseBtn = document.getElementById('startPauseBtn');
        const completeBtn = document.getElementById('completeBtn');
        const taskCard = document.getElementById('taskCard');
        const modeIndicator = document.getElementById('modeIndicator');
        const completionAnimation = document.getElementById('completionAnimation');
        const swipeArea = document.getElementById('swipeArea');
        const initialTaskInput = document.getElementById('initialTaskInput');
        const newTaskInput = document.getElementById('newTaskInput');
        const addNewTaskBtn = document.getElementById('addNewTaskBtn');
        const startTasksBtn = document.getElementById('startTasksBtn');
        const taskList = document.getElementById('taskList');
        const breakCard = document.getElementById('breakCard');
        const breakText = document.getElementById('breakText');
        const breakTimerDisplay = document.getElementById('breakTimerDisplay');
        const breakProgressBar = document.getElementById('breakProgressBar');
        const longBreakMessage = document.getElementById('longBreakMessage');
        // const settingsIcon = document.getElementById('settingsIcon'); // Ikke brugt i denne version

        // App State
        let tasks = [];
        let currentTaskIndex = 0;
        let timeRemaining = 25 * 60; // 25 minutes in seconds
        let breakTimeRemaining = 5 * 60; // 5 minutes in seconds (default short break)
        let timerInterval = null;
        let breakTimerInterval = null;
        let isRunning = false;
        let isBreakRunning = false;
        let isFocusMode = true; // Starter i fokus mode
        let pomodoroCount = 0; // Antal gennemførte pomodoroer

        // Sound effects (Beholdt som i original kode)
        // En simpel base64 encodet bip lyd (forkortet for læsbarhed)
        const beepSound = new Audio('data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YS');


        // Initialize the app
        function init() {
            updateTimerDisplay();
            setupEventListeners();
            showInitialInput(); // Start med at vise input skærmen
        }

        // Update the task display (Show task card)
        function updateTaskDisplay() {
            console.log("Updating task display. Current task index:", currentTaskIndex, "Tasks length:", tasks.length); // Debug log
            if (tasks.length === 0 || currentTaskIndex >= tasks.length) {
                console.log("No more tasks. Showing initial input."); // Debug log
                showInitialInput(); // Vis startskærm hvis der ikke er flere opgaver
                return;
            }

            const currentTask = tasks[currentTaskIndex];
            taskText.textContent = currentTask.text;

            // Reset timer to 25 minutes for focus mode
            timeRemaining = 25 * 60;
            updateTimerDisplay();
            resetProgressBar();

            // Show task card and hide others
            initialTaskInput.classList.add('hidden');
            taskCard.classList.remove('hidden');
            breakCard.classList.add('hidden');

            modeIndicator.textContent = 'Fokustid';
            modeIndicator.style.color = 'var(--pomodoro-primary)'; // Orange farve for fokus

             // Sæt knappen til Start, men start ikke automatisk
             isRunning = false; // Sørg for at timeren ikke tror den kører
             clearInterval(timerInterval); // Stop evt. kørende interval
             startPauseBtn.innerHTML = '<i class="fas fa-play"></i> Start'; // Sæt til Start
             startPauseBtn.classList.remove('btn-secondary'); // Brug primær farve
             startPauseBtn.classList.add('btn-primary');
             console.log("Task display updated. Ready to start timer."); // Debug log
        }

        // Update the timer display
        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Update the break timer display
        function updateBreakTimerDisplay() {
            const minutes = Math.floor(breakTimeRemaining / 60);
            const seconds = breakTimeRemaining % 60;
            breakTimerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Reset the progress bar
        function resetProgressBar() {
            progressBar.style.width = '0%';
            breakProgressBar.style.width = '0%';
        }

        // Update the progress bar
        function updateProgressBar() {
            const totalTime = 25 * 60; // 25 minutes in seconds (Pomodoro duration)
            const percentComplete = 100 - ((timeRemaining / totalTime) * 100);
            progressBar.style.width = `${percentComplete}%`;
        }

        // Update the break progress bar
        function updateBreakProgressBar() {
            let totalBreakTime;

            // Determine break duration based on pomodoro count
            if (pomodoroCount > 0 && pomodoroCount % 4 === 0) { // Lang pause efter hver 4. pomodoro
                totalBreakTime = 15 * 60; // 15 minutes for long break
            } else {
                totalBreakTime = 5 * 60; // 5 minutes for regular short breaks
            }

            const percentComplete = 100 - ((breakTimeRemaining / totalBreakTime) * 100);
            breakProgressBar.style.width = `${percentComplete}%`;
        }

        // Start or pause the timer
        function toggleTimer() {
            if (isBreakRunning) return; // Kan ikke starte fokus timer under pause

            if (isRunning) {
                clearInterval(timerInterval);
                startPauseBtn.innerHTML = '<i class="fas fa-play"></i> Start'; // Skift til Start ikon
                 startPauseBtn.classList.remove('btn-secondary'); // Sørg for korrekt knapfarve
                 startPauseBtn.classList.add('btn-primary');
            } else {
                timerInterval = setInterval(updateTimer, 1000);
                startPauseBtn.innerHTML = '<i class="fas fa-pause"></i> Pause'; // Skift til Pause ikon
                 startPauseBtn.classList.remove('btn-primary'); // Sørg for korrekt knapfarve
                 startPauseBtn.classList.add('btn-secondary');
                playBeep(); // Afspil lyd ved start
            }

            isRunning = !isRunning;
        }

        // Start the break timer
        function startBreakTimer() {
            console.log("Starting break timer. Pomodoro count:", pomodoroCount); // Debug log
            clearInterval(timerInterval); // Stop fokus timer
            isRunning = false;
             // Nulstil fokus knap tekst/ikon og klasser
             startPauseBtn.innerHTML = '<i class="fas fa-play"></i> Start';
             startPauseBtn.classList.remove('btn-secondary');
             startPauseBtn.classList.add('btn-primary');


            // Determine break duration based on pomodoro count
            if (pomodoroCount > 0 && pomodoroCount % 4 === 0) { // Lang pause efter hver 4. pomodoro
                breakTimeRemaining = 15 * 60; // 15 minutes
                longBreakMessage.textContent = "Lang pause: Gå en tur eller stræk dig!";
                longBreakMessage.classList.remove('hidden');
                breakText.textContent = "Pause";
            } else {
                breakTimeRemaining = 5 * 60; // 5 minutes
                longBreakMessage.classList.add('hidden');
                breakText.textContent = "Kort pause";
            }

            updateBreakTimerDisplay();
            resetProgressBar(); // Nulstil begge progress bars

            // Show break card and hide others
            taskCard.classList.add('hidden');
            breakCard.classList.remove('hidden');
            initialTaskInput.classList.add('hidden'); // Skjul også initial input

            modeIndicator.textContent = 'Pausetid';
            modeIndicator.style.color = 'var(--pomodoro-break)'; // Teal farve for pause

            // Auto-start the break timer
            if (!isBreakRunning) {
                 clearInterval(breakTimerInterval); // Ryd evt. gammelt interval
                breakTimerInterval = setInterval(updateBreakTimer, 1000);
                isBreakRunning = true;
                playBeep(); // Afspil lyd ved start af pause
            }
             console.log("Break timer started."); // Debug log
        }

        // Update the timer
        function updateTimer() {
            if (timeRemaining <= 0) {
                clearInterval(timerInterval);
                isRunning = false;
                 // Knap skal ikke ændres her, den nulstilles når pausen starter
                // startPauseBtn.innerHTML = '<i class="fas fa-play"></i> Start';

                // Increment pomodoro count
                pomodoroCount++;
                 console.log("Pomodoro finished. Count:", pomodoroCount); // Debug log

                // Switch to break mode
                startBreakTimer();
                return;
            }

            timeRemaining--;
            updateTimerDisplay();
            updateProgressBar();
        }

        // Update the break timer
        function updateBreakTimer() {
            if (breakTimeRemaining <= 0) {
                clearInterval(breakTimerInterval);
                isBreakRunning = false;
                 console.log("Break finished."); // Debug log

                // Switch back to focus mode
                isFocusMode = true;
                 // Find næste opgave ELLER vis initial input hvis ingen tilbage
                 currentTaskIndex++; // Gå til næste opgave
                 updateTaskDisplay(); // Opdater visningen til næste opgave eller input
                return;
            }

            breakTimeRemaining--;
            updateBreakTimerDisplay();
            updateBreakProgressBar();
        }

        // Complete the current task manually
        function completeTask() {
            console.log("Task completed manually."); // Debug log
            // Stop den nuværende timer, hvis den kører
            clearInterval(timerInterval);
            isRunning = false;
            // Nulstil knappen til "Start" state
            startPauseBtn.innerHTML = '<i class="fas fa-play"></i> Start';
            startPauseBtn.classList.remove('btn-secondary');
            startPauseBtn.classList.add('btn-primary');


            // Vis completion animation
            completionAnimation.classList.add('active');
            playBeep(); // Afspil lyd ved færdiggørelse

            setTimeout(() => {
                completionAnimation.classList.remove('active');

                // Increment pomodoro count (tæller som en fuld pomodoro)
                pomodoroCount++;
                 console.log("Pomodoro count after manual completion:", pomodoroCount); // Debug log

                // Switch to break mode
                startBreakTimer();
            }, 1500); // Animation varighed
        }

        // Show the initial input screen
        function showInitialInput() {
            console.log("Showing initial input screen."); // Debug log
            initialTaskInput.classList.remove('hidden');
            taskCard.classList.add('hidden');
            breakCard.classList.add('hidden');
            modeIndicator.textContent = 'Tilføj opgaver';
            modeIndicator.style.color = 'var(--text-color)'; // Standard tekstfarve
            timerDisplay.textContent = '25:00'; // Nulstil timer display
            resetProgressBar(); // Nulstil progress bars
            // Sørg for at timerne er stoppet
            clearInterval(timerInterval);
            clearInterval(breakTimerInterval);
            isRunning = false;
            isBreakRunning = false;
            currentTaskIndex = 0; // Nulstil opgaveindeks når vi går tilbage til input
             pomodoroCount = 0; // Nulstil pomodoro tæller
             tasks = []; // Nulstil opgavelisten når vi går helt tilbage
             renderTaskList(); // Vis den (nu tomme) opgaveliste
        }

        // Add a new task to the list
        function addNewTask() {
            const text = newTaskInput.value.trim();

            if (text) {
                const newTask = {
                    id: Date.now(),
                    text: text,
                    completed: false // Selvom den ikke bruges aktivt i denne version, beholdes den for struktur
                };

                tasks.push(newTask);
                renderTaskList();
                newTaskInput.value = '';
                newTaskInput.focus();
                 console.log("Task added:", newTask); // Debug log
            }
        }

        // Render the task list in the initial view
        function renderTaskList() {
            taskList.innerHTML = ''; // Ryd eksisterende liste

            if (tasks.length === 0) {
                 taskList.innerHTML = '<div style="text-align: center; color: var(--text-color); opacity: 0.7; margin-top: 1rem;">Ingen opgaver tilføjet endnu.</div>'; // Vis besked hvis tom
                 startTasksBtn.disabled = true; // Deaktiver start knap hvis ingen opgaver
                 startTasksBtn.classList.add('btn-secondary'); // Grå knap
                 startTasksBtn.classList.remove('btn-primary');
                 return;
            }

             startTasksBtn.disabled = false; // Aktiver start knap
             startTasksBtn.classList.remove('btn-secondary');
             startTasksBtn.classList.add('btn-primary'); // Grøn knap


            tasks.forEach((task, index) => {
                const taskItem = document.createElement('div');
                taskItem.className = 'task-item';
                taskItem.innerHTML = `
                    <span>${index + 1}. ${task.text}</span>
                    <button class="btn btn-secondary btn-sm remove-task" data-id="${task.id}" style="padding: 0.3rem 0.6rem; font-size: 0.8rem;"> <!-- Mindre fjern knap -->
                         <i class="fas fa-trash-alt" style="pointer-events: none;"></i> <!-- Ikon skal ikke fange klik -->
                    </button>
                `;
                taskList.appendChild(taskItem);
            });

            // Add event listeners to remove buttons
            document.querySelectorAll('.remove-task').forEach(button => {
                button.addEventListener('click', (e) => {
                    const taskId = parseInt(button.getAttribute('data-id')); // Få id fra knappen
                    tasks = tasks.filter(task => task.id !== taskId);
                    renderTaskList(); // Opdater listen med det samme
                     console.log("Task removed. Remaining tasks:", tasks); // Debug log
                     // Hvis den sidste opgave fjernes, deaktiver start knappen igen
                     if (tasks.length === 0) {
                         startTasksBtn.disabled = true;
                         startTasksBtn.classList.add('btn-secondary');
                         startTasksBtn.classList.remove('btn-primary');
                     }
                });
            });
        }

        // Start the Pomodoro timer with the added tasks
        function startPomodoro() {
            console.log("Starting Pomodoro."); // Debug log
            if (tasks.length === 0) {
                // Burde ikke ske pga. disabled knap, men god praksis at tjekke
                alert('Tilføj mindst én opgave for at starte');
                return;
            }

            currentTaskIndex = 0; // Start fra første opgave
            pomodoroCount = 0; // Nulstil pomodoro tæller ved ny start
            isFocusMode = true; // Start i fokus mode
            updateTaskDisplay(); // Vis første opgave og gør klar til start
             // Start timeren automatisk når "Start Pomodoro" klikkes
             // if (!isRunning) { // Tjek overflødigt, da updateTaskDisplay nulstiller isRunning
                 toggleTimer(); // Start timeren
            // }
        }

        // Play beep sound
        function playBeep() {
            // Tjek om lyd er slået fra i indstillinger (ikke implementeret endnu)
            // For nu, spil altid lyden
            beepSound.currentTime = 0;
            beepSound.play().catch(e => console.log("Couldn't play sound:", e));
        }

        // Setup event listeners
        function setupEventListeners() {
            // Task input
            addNewTaskBtn.addEventListener('click', addNewTask);

            newTaskInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault(); // Forhindrer standard Enter handling (form submission)
                    addNewTask();
                }
            });

            startTasksBtn.addEventListener('click', startPomodoro);

            // Timer controls
            startPauseBtn.addEventListener('click', toggleTimer);
            completeBtn.addEventListener('click', completeTask);

            // Swipe to complete (Basic implementation)
            let startX = 0;
            let moveX = 0;
            let swiping = false; // Flag to track if a swipe is in progress

            swipeArea.addEventListener('touchstart', e => {
                 if (isRunning) return; // Don't allow swipe actions while timer is running
                startX = e.touches[0].clientX;
                 moveX = startX; // Initialize moveX
                 swiping = true;
                 swipeArea.classList.add('swiping'); // Tilføj swiping klasse for visuel feedback
            });

            swipeArea.addEventListener('touchmove', e => {
                 if (!swiping || isRunning) return; // Only process if swiping and timer paused
                moveX = e.touches[0].clientX;
                const diff = moveX - startX;

                // Begræns swipe til højre
                if (diff > 0) {
                     taskCard.style.transition = 'none'; // Disable transition during swipe for smoothness
                    taskCard.style.transform = `translateX(${Math.min(diff, 150)}px)`; // Begræns hvor langt man kan swipe
                } else {
                     // Nulstil transform hvis man swiper til venstre
                     taskCard.style.transition = 'transform 0.3s ease'; // Re-enable transition
                     taskCard.style.transform = 'translateX(0)';
                }
            });

            swipeArea.addEventListener('touchend', e => {
                 if (!swiping || isRunning) { // Check if a valid swipe was in progress and timer paused
                     swiping = false; // Reset swipe flag regardless
                     return;
                 }

                const diff = moveX - startX;
                 taskCard.style.transition = 'transform 0.3s ease'; // Re-enable transition

                if (diff > 100) { // Threshold for completion
                    // Swiped far enough to complete (juster tærskel efter behov)
                    completeTask();
                } else {
                     // Snap back if not swiped far enough
                    taskCard.style.transform = 'translateX(0)';
                }

                // Nulstil swiping klasse og tilstand
                 swipeArea.classList.remove('swiping');
                 swiping = false;
                 startX = 0;
                 moveX = 0;
            });

             // Settings icon (ikke fuldt implementeret i denne version)
             // if (settingsIcon) { // Tjek om elementet findes
             //     settingsIcon.addEventListener('click', () => {
             //         // Åbn indstillingspanel
             //         console.log("Settings icon clicked (functionality not implemented)");
             //     });
             // }
        }

        // Initialize the app when the DOM is fully loaded
         document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
